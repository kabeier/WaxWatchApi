# Local/development reference only.
# Do not use this file directly for production deployments; inject runtime env vars/secrets via CI/CD or a secret manager.

# --- Core app ---
APP_NAME=watch-wax-api
ENVIRONMENT=dev
LOG_LEVEL=INFO
JSON_LOGS=true

# Database connection string (required; secret in real deployments)
DATABASE_URL=

# DB pooling
# - dev/local Postgres: queue
# - Supabase/PgBouncer: null
DB_POOL=queue
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=10

# --- Dev/test toggles ---
# Dev convenience only; keep false in production.
DEV_AUTO_CREATE_USERS=true
# Enable immediate backfill when rules change (dev/test convenience).
DEV_BACKFILL_ON_RULE_CHANGE=true
DEV_BACKFILL_DAYS=7
DEV_BACKFILL_LIMIT=500
# Optional provider override used by tests/local debugging; do not set in prod.
PROVIDER_FORCE_MOCK=0

# --- Scheduler runtime tuning ---
# Local/dev can use short intervals for fast feedback.
# Prod should tune conservatively for load and API quotas.
SCHEDULER_POLL_INTERVAL_SECONDS=15
SCHEDULER_BATCH_SIZE=100
SCHEDULER_RULE_LIMIT=20
SCHEDULER_NEXT_RUN_JITTER_SECONDS=5
SCHEDULER_FAILURE_RETRY_JITTER_SECONDS=5

# --- Celery ---
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/1
# Usually false in prod workers; can be true in unit tests.
CELERY_TASK_ALWAYS_EAGER=false
CELERY_TASK_EAGER_PROPAGATES=true
CELERY_TASK_RETRY_BACKOFF_SECONDS=5
CELERY_TASK_MAX_RETRIES=4
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_WORKER_MAX_TASKS_PER_CHILD=100

# --- CORS ---
# Use explicit origins whenever credentials are enabled; never combine '*' with credentials.
CORS_ALLOWED_ORIGINS=
CORS_ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Authorization,Content-Type
CORS_ALLOW_CREDENTIALS=false

# --- Discogs provider ---
DISCOGS_USER_AGENT=
DISCOGS_TOKEN=
DISCOGS_OAUTH_CLIENT_ID=
DISCOGS_OAUTH_CLIENT_SECRET=
DISCOGS_OAUTH_REDIRECT_URI=
DISCOGS_OAUTH_SCOPES=identity wantlist collection
DISCOGS_OAUTH_STATE_TTL_SECONDS=600
DISCOGS_TIMEOUT_SECONDS=10.0
DISCOGS_MAX_ATTEMPTS=4
DISCOGS_RETRY_BASE_DELAY_MS=250
DISCOGS_RETRY_MAX_DELAY_MS=5000

# --- eBay provider ---
EBAY_CLIENT_ID=
EBAY_CLIENT_SECRET=
EBAY_OAUTH_SCOPE=https://api.ebay.com/oauth/api_scope
EBAY_MARKETPLACE_ID=EBAY_US
EBAY_TIMEOUT_SECONDS=10.0
EBAY_MAX_ATTEMPTS=4
EBAY_RETRY_BASE_DELAY_MS=250
EBAY_RETRY_MAX_DELAY_MS=5000

# eBay affiliate monetization (usually enabled in prod only)
EBAY_CAMPAIGN_ID=
EBAY_CUSTOM_ID=

# --- Error reporting ---
SENTRY_DSN=
# Optional explicit environment for Sentry event tagging.
SENTRY_ENVIRONMENT=
# JSON list or comma-separated values.
SENTRY_ENABLED_ENVIRONMENTS=["staging","prod"]
SENTRY_TRACES_SAMPLE_RATE=0.0

# --- Supabase auth / JWT validation ---
# Optional when AUTH_ISSUER + AUTH_JWKS_URL are provided directly.
SUPABASE_URL=
AUTH_ISSUER=
AUTH_AUDIENCE=authenticated
AUTH_JWKS_URL=
AUTH_JWT_ALGORITHMS=["RS256"]
AUTH_JWKS_CACHE_TTL_SECONDS=300
AUTH_CLOCK_SKEW_SECONDS=30

# --- Token crypto (encrypt ExternalAccountLink.access_token at rest) ---
TOKEN_CRYPTO_KMS_KEY_ID=
TOKEN_CRYPTO_LOCAL_KEY_PATH=
TOKEN_CRYPTO_LOCAL_KEY=
